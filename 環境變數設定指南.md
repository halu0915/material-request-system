# 🔧 Render 環境變數設定詳細指南

## 📋 快速設定清單

### 🔴 必須設定的環境變數（5個）

| 變數名稱 | 值 | 說明 |
|---------|-----|------|
| `NODE_ENV` | `production` | 執行環境 |
| `PORT` | `5000` | 服務端口 |
| `DATABASE_URL` | `<從PostgreSQL複製>` | 資料庫連接字串 |
| `JWT_SECRET` | `OkcpmA5cA9AfyLiGbK0nIelObvmiRPopuKryFW2N/io=` | JWT 密鑰 |
| `FRONTEND_URL` | `https://material-request-system.onrender.com` | 前端URL（部署後更新） |

### 🟡 建議設定的環境變數（2個）

| 變數名稱 | 值 | 說明 |
|---------|-----|------|
| `TRIAL_EMAIL` | `trial@material-request.com` | 試用帳號郵箱 |
| `TRIAL_PASSWORD` | `trial123456` | 試用帳號密碼 |

---

## 📝 詳細設定步驟

### 方法 1: 在 Render Dashboard 設定（推薦）

1. **進入 Web Service 設定頁面**
   - 在 Render Dashboard 選擇您的 Web Service：`material-request-system`
   - 點選左側選單的「Environment」

2. **新增環境變數**
   - 在「Environment Variables」區塊
   - 點選「Add Environment Variable」按鈕
   - 逐一新增以下變數：

#### 步驟 1: 新增 NODE_ENV
- **Key**: `NODE_ENV`
- **Value**: `production`
- 點選「Save」

#### 步驟 2: 新增 PORT
- **Key**: `PORT`
- **Value**: `5000`
- 點選「Save」

#### 步驟 3: 新增 DATABASE_URL
- **Key**: `DATABASE_URL`
- **Value**: `<從PostgreSQL服務複製的Internal Database URL>`
  - 格式範例：`postgresql://user:pass@dpg-xxxxx-a.singapore-postgres.render.com/dbname`
  - ⚠️ **重要**：必須使用 Internal Database URL
- 點選「Save」

#### 步驟 4: 新增 JWT_SECRET
- **Key**: `JWT_SECRET`
- **Value**: `OkcpmA5cA9AfyLiGbK0nIelObvmiRPopuKryFW2N/io=`
- 點選「Save」

#### 步驟 5: 新增 FRONTEND_URL
- **Key**: `FRONTEND_URL`
- **Value**: `https://material-request-system.onrender.com`
  - ⚠️ **注意**：部署完成後，請更新為實際的服務 URL
- 點選「Save」

#### 步驟 6: 新增試用帳號（建議）
- **Key**: `TRIAL_EMAIL`
- **Value**: `trial@material-request.com`
- 點選「Save」

- **Key**: `TRIAL_PASSWORD`
- **Value**: `trial123456`
- 點選「Save」

3. **確認設定**
   - 確認所有變數都已正確新增
   - 檢查變數值是否正確
   - 儲存後，服務會自動重新部署

---

## 📋 完整的環境變數列表

### 可直接複製的格式

```bash
# === 必要環境變數 ===
NODE_ENV=production
PORT=5000
DATABASE_URL=<從PostgreSQL複製的Internal Database URL>
JWT_SECRET=OkcpmA5cA9AfyLiGbK0nIelObvmiRPopuKryFW2N/io=
FRONTEND_URL=https://material-request-system.onrender.com

# === 建議設定的試用帳號 ===
TRIAL_EMAIL=trial@material-request.com
TRIAL_PASSWORD=trial123456

# === 可選環境變數（可稍後設定）===
# Google OAuth
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=https://material-request-system.onrender.com/api/auth/google/callback

# 郵件服務
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=
SMTP_FROM=

# LINE Notify
LINE_NOTIFY_CLIENT_ID=
LINE_NOTIFY_CLIENT_SECRET=
LINE_NOTIFY_REDIRECT_URI=https://material-request-system.onrender.com/api/auth/line/callback

# Google Drive
GOOGLE_DRIVE_CLIENT_ID=
GOOGLE_DRIVE_CLIENT_SECRET=
GOOGLE_DRIVE_REDIRECT_URI=https://material-request-system.onrender.com/api/drive/callback
GOOGLE_DRIVE_REFRESH_TOKEN=
```

---

## ✅ 設定檢查清單

完成設定後，請確認：

- [ ] `NODE_ENV` = `production`
- [ ] `PORT` = `5000`
- [ ] `DATABASE_URL` 已設定（Internal URL）
- [ ] `JWT_SECRET` 已設定
- [ ] `FRONTEND_URL` 已設定
- [ ] `TRIAL_EMAIL` 已設定（建議）
- [ ] `TRIAL_PASSWORD` 已設定（建議）

---

## 🔍 如何取得 DATABASE_URL

1. 在 Render Dashboard 選擇您的 PostgreSQL 服務
2. 進入資料庫設定頁面
3. 找到「Connection」區塊
4. 複製「Internal Database URL」
5. 格式類似：`postgresql://user:password@host:port/database`

⚠️ **重要提醒**：
- 必須使用「Internal Database URL」
- 不要使用「External Database URL」
- Internal URL 只能在 Render 內部網路使用，更安全

---

## 📝 設定完成後

1. **檢查部署日誌**
   - 回到 Web Service 的「Logs」頁籤
   - 確認服務是否正常啟動
   - 檢查是否有錯誤訊息

2. **測試服務**
   - 訪問：`https://material-request-system.onrender.com/health`
   - 應該看到：`{"status":"ok","timestamp":"..."}`

3. **更新 FRONTEND_URL**
   - 部署完成後，Render 會顯示實際的服務 URL
   - 格式可能是：`https://material-request-system-xxxx.onrender.com`
   - 請更新 `FRONTEND_URL` 環境變數為實際的 URL

---

## 🆘 常見問題

### Q: 找不到 Internal Database URL？
A: 
1. 確認 PostgreSQL 服務已建立完成
2. 進入資料庫設定頁面
3. 查看「Connection」區塊
4. 如果只有 External URL，確認資料庫是否在同一區域

### Q: 設定環境變數後服務沒有重新部署？
A:
- 手動觸發重新部署：在 Web Service 設定中點選「Manual Deploy」
- 或檢查 Auto-Deploy 是否已開啟

### Q: 如何知道環境變數是否設定成功？
A:
- 查看「Environment」頁籤，應該會顯示所有已設定的變數
- 檢查「Logs」頁籤，查看服務啟動時的環境變數日誌

---

## 📞 需要協助？

如果遇到問題：
1. 檢查「Logs」頁籤的錯誤訊息
2. 確認所有必要環境變數都已設定
3. 參考 Render 文件：https://render.com/docs/environment-variables

