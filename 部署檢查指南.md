# 部署檢查指南

## ✅ 已觸發重新部署

已推送空的 commit 來觸發 Render 重新部署。

---

## 📋 檢查部署狀態

### 1. 訪問 Render Dashboard
👉 https://dashboard.render.com

服務名稱：**material-request-system**

### 2. 查看構建日誌 (Build Logs)

應該看到以下步驟：

```
🔨 開始構建流程...

📦 步驟 1: 安裝依賴...
✅ npm install
✅ cd server && npm install
✅ cd client && npm install

🔨 步驟 2: 構建後端...
✅ TypeScript 編譯

📋 步驟 2.5: 複製備用 HTML 文件...
✅ 備用 HTML 文件已複製到 server/dist/public/

🔨 步驟 3: 構建前端...
✅ vite build

✅ 步驟 4: 驗證構建結果...
✅ 前端構建成功！

🎉 構建完成！
```

### 3. 查看實時日誌 (Live Logs)

服務器啟動時應該看到：

```
🔍 開始尋找前端構建文件...
📁 NODE_ENV: production
📁 當前工作目錄: /opt/render/project/src
📁 __dirname: /opt/render/project/src/server/dist

🔍 檢查: /opt/render/project/src/client/dist
  ✓ 目錄存在
  ✓ index.html 存在
  ✅ ✅ ✅ 找到前端構建文件！
  📍 位置: /opt/render/project/src/client/dist
```

或者（如果前端構建失敗）：

```
⚠️ ⚠️ ⚠️  前端構建文件未找到！
📋 將使用備用 HTML 頁面
✅ 使用備用 HTML 頁面: /opt/render/project/src/server/dist/public
```

---

## 🌐 測試網站

部署完成後，訪問：
👉 **https://material-request-system-uadw.onrender.com**

### 預期結果

**情況 1: 前端構建成功**
- 看到完整的 React 前端界面
- 可以登入、註冊、或使用訪客登入

**情況 2: 前端構建失敗（但應該不會發生）**
- 看到備用 HTML 頁面
- 仍可以點擊「以訪客身份試用」登入
- 使用所有 API 功能

---

## 🔍 常見問題排查

### 問題 1: 構建失敗

**檢查：**
- 構建日誌中的錯誤訊息
- 是否有依賴安裝失敗
- 前端構建是否有錯誤

**解決：**
- 查看具體錯誤訊息
- 確認所有環境變數已設置

### 問題 2: 前端文件未找到

**檢查：**
- 實時日誌中的路徑檢查訊息
- `client/dist/index.html` 是否存在
- `server/dist/public/index.html` 是否存在

**解決：**
- 檢查構建日誌確認前端是否構建
- 查看路徑是否正確

### 問題 3: 網站顯示 JSON 而非界面

**檢查：**
- 實時日誌中的前端查找結果
- 是否兩個路徑都找不到

**解決：**
- 至少備用 HTML 應該存在
- 檢查 `server/dist/public/index.html` 是否被正確複製

---

## 📝 關鍵文件位置

- **前端構建**: `client/dist/`
- **備用 HTML**: `server/dist/public/index.html`
- **構建腳本**: `build.sh`
- **服務器入口**: `server/dist/index.js`

---

## 🎯 最新改進總結

1. ✅ **構建腳本** (`build.sh`) - 確保前端一定會構建
2. ✅ **備用 HTML 頁面** (`server/public/index.html`) - 即使構建失敗也能使用
3. ✅ **自動複製 public 目錄** - 確保備用頁面在 dist 中
4. ✅ **詳細的診斷日誌** - 清楚看到文件查找過程
5. ✅ **改進的路由邏輯** - 優先前端，降級到備用頁面

---

## ⚡ 快速測試

部署完成後，快速測試：

1. **訪問首頁**
   ```
   https://material-request-system-uadw.onrender.com
   ```
   應該看到界面，不是 JSON

2. **測試訪客登入**
   點擊「以訪客身份試用」
   應該能成功登入

3. **測試 API**
   ```
   https://material-request-system-uadw.onrender.com/health
   ```
   應該返回 `{"status":"ok",...}`

4. **檢查實時日誌**
   在 Render Dashboard 查看實時日誌
   應該看到詳細的前端查找訊息

---

## 🆘 需要幫助？

如果部署後仍有問題，請提供：

1. **構建日誌** - 完整的構建輸出
2. **實時日誌** - 服務器啟動時的完整日誌
3. **網站響應** - 訪問首頁時看到的內容

這樣我可以進一步診斷問題！



